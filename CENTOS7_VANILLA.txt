#Instatiated new centos 7 machine

# got recent base
sudo yum upgrade -y

# Install devel tools
sudo  yum group install "Development Tools" -y
# install X
sudo yum groupinstall "X Window System" -y

# install more dev tools
sudo yum install gcc-gfortran netcdf netcdf-fortran netcdf-devel netcdf-fortran-devel emacs libX11-devel -y

# pgplot, sigh
mkdir -p ~/local/src
pushd ~/local/src
curl -o pgplot522.tar.gz ftp://ftp.astro.caltech.edu/pub/pgplot/pgplot522.tar.gz
tar -xvzf pgplot522.tar.gz
cd pgplot
./makemake $PWD linux g77_gcc
# LOL g77 doesnt exist anymore
sed -i 's/=g77/=gfortran/g'  makefile
make
# sigh, I know like basic graphics were state of the art back then,
# but software has changed a lot
sed -i 's#/usr/X11R6/lib#/usr/lib64/#g' makefile
cmd="export PGPLOT_DIR=$HOME/local/pgplot"
$cmd
echo $cmd >> ~/.bashrc
mkdir -p $PGPLOT_DIR
cp  libpgplot.a libpgplot.so grfont.dat rgb.txt $PGPLOT_DIR
popd

mkdir -p ~/src
pushd ~/src
#sets up ssh key
git clone git@github.com:garrettwrong/cql3d_f90.git
cd cql3d_f90
make -f  makefile_gfortran64.CentOS7 -j2 |& tee make.oe

# runs, but halts on complaints about pgplot. I didn't have time to debug that /again/.
